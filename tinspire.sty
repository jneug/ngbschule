
%% -----------------
%%
%% Darstellung von Tasten des TI-NSPIRE
%%
%% -----------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tinspire}[2018/12/05  Paket zur Darstellung von Tasten des TI-NSPIRE Taschenrechners]

% option keepBorder keeps black border for ctrl key
% option keepSecondarySpace keeps space for secondary function even if empty

%\RequirePackage{pgfopts}
\RequirePackage[table]{xcolor}
\RequirePackage{tikz}

\usetikzlibrary{calc,shadows,backgrounds}

% Paketoptionen
%\newboolean{tin@keepBorder}
%\newboolean{tin@keepSpaces}
%\newboolean{tin@colors}

%\pgfkeys{
%	/tin/.cd,
%	keepBorder/.value forbidden,
%	keepBorder/.code=\setboolean{tin@keepBorder}{true},
%	keepSpaces/.value forbidden,
%	keepSpaces/.code=\setboolean{tin@keepSpaces}{true},
%	colors/.value forbidden,
%	colors/.code=\setboolean{tincolors}{true},
%	.unknown/.code={}, % Unbekannte Optionen ignorieren.
%}

%\ProcessPgfPackageOptions{/ngb}

\definecolor{tinctrlclr}{RGB}{214,248,255}
\definecolor{tinsecondaryclr}{RGB}{131,196,209}
\definecolor{tinselectionclr}{RGB}{116,186,237}
\definecolor{tindisplayclr}{gray}{.95}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              Style definitions              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\tin@corners{1pt}
\def\tin@minwidth{6ex}
\tikzset{
	tinbase/.style={
		white,
		rectangle,
		rounded corners=\tin@corners,
		text height=1.5ex,
		text depth=.25ex,
		inner sep=3pt,
		font=\sffamily\bfseries,
	},
	tinshadow/.style={
		drop shadow={
			fill=black,
			opacity=0.75,
			shadow xshift=0.15ex,
			shadow yshift=-0.15ex,
		}
	},
	tinbutton/.style={
		tinbase,
		draw=black,
		fill=black!90,
		text=white,
		minimum width=\tin@minwidth,
	},
	tinkey/.style={
		tinbutton,
		tinshadow,
	},
	tinctrl/.style={
			black,
			draw=tinctrlclr,
			fill=tinctrlclr,
			text=black,
	},
	tinsecondary/.style={
		tinsecondaryclr,
		yshift=-.3ex,
		font=\fontsize{1ex}{0}\selectfont\sffamily\bfseries,
		text depth=0pt
	},
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              Helper macros              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\tin@button}[3][]{%
	\node at (0,0) [tinbutton,label={[tinsecondary]above:#3},#1] (btn) {#2\strut}
}
\newcommand{\tin@key}[3][]{%
	\node at (0,0) [tinkey,label={[tinsecondary]above:#3},#1] (key) {#2\strut}
}
\newcommand{\tin@sec}[2][]{%
	\node at (0,0) [tinsecondary,label={above:#2},#1] (sec) {\strut}
}

%% Main macros
\newcommand{\TINkey}[3][]{\tikz[baseline=(key.base)]{%
	\tin@key[#1]{#2}{#3};
}\xspace}

\newcommand{\TINright}[3][]{\tikz[baseline=(shape.base)]{%
	\node at (0,0)[fill=red,tinbase,minimum width=4ex,anchor=south west] (shape) {\phantom{#2}};
	\begin{scope}[x=(shape.south east),y=(shape.north west)]
		\fill[black] (0,0) {[rounded corners=\tin@corners] -- ++(1,0) -- ++(0,1)} -- ++(-1,0) -- cycle {};
	\end{scope}
	\node at (0,0) [tinbase,tinshadow,minimum width=4ex,anchor=south west,label={[tinsecondary]above:#3}] (key) {#2\strut};
}\xspace}
\newcommand{\TINleft}[3][]{\tikz[baseline=(shape.base)]{%
	\node at (0,0)[fill=red,tinbase,minimum width=4ex,anchor=south west] (shape) {\phantom{#2}};
	\begin{scope}[x=(shape.south east),y=(shape.north west)]
		\fill[black] (1,1) {[rounded corners=\tin@corners] -- ++(-1,0) -- ++(0,-1)} -- ++(1,0) -- cycle {};
	\end{scope}
	\node at (0,0) [tinbase,tinshadow,minimum width=4ex,anchor=south west,label={[tinsecondary]above:#3}] (key) {#2\strut};
}\xspace}
\newcommand{\TINdouble}[4]{\TINleft{#1}{#2}\hspace{-.5ex}\TINright{#3}{#4}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Symbols                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand\tin@calculator{\tikz{
%		\node (c) [inner sep=0pt, draw, fill=black, anchor=south west]{\phantom{N}};
%		\begin{scope}[x=(c.south east),y=(c.north west)]
%			\fill[white] (.1,.7) rectangle (.9,.9);
%			\foreach \x in {.1, .33, .55, .79}{
%				\foreach \y in {.1, .24, .38, .53}{
%					\fill[white] (\x,\y) rectangle +(.11,.07);}}
%		\end{scope}
%}}
\newcommand\tin@calculator{\tikz[baseline,thick,scale={\f@size/11pt},]{
	\draw (0,0) -- (.05,.3); \draw (.05,0) -- (.1,.3);
	\draw (.1,0) -- (.3,0) -- (.35,.3) -- (.15,.3) -- cycle {};
	\foreach \x/\y in {.1/.05,.11/.1,.12/.15}{
		\draw (\x,\y) -- +(.2,0);}
	\foreach \x in {.19,.26}{
		\draw (\x,.15) -- +(-.03,-.15);}
}}
\newcommand\tin@house{\tikz[baseline,thick,scale={\f@size/11pt},]{
	\draw (.05,0) -- (.15,0) -- (.15,.1) -- (.25,.1) -- (.25,0) -- (.35,0)
		-- (.35,.15) -- (.4,.15) -- (.35,.19) -- (.35,.3) -- (.29,.3) -- (.29,.23) -- (.2,.3) -- (0,.15) -- (.05,.15) -- (.05,0);
}}
\newcommand\tin@caret{\tikz[baseline,scale={\f@size/11pt},]{
	\fill (0,.15) -- (.2,.15) -- (.1,0) -- (0,.15);
}}
\newcommand\tin@rcaret{\tikz[baseline,scale={\f@size/11pt},]{
	\fill (0,0) -- (.15,.1) -- (0,.2) -- (0,0);
}}
\newcommand\tin@menu{\tikz[baseline,scale={\f@size/11pt},]{
	\draw[thick] (0,0) rectangle (.5,.4);
	\foreach \y in {.1,.2,.3}{
		\draw (.1,\y) -- +(.3,0);}
}}
\newcommand\tin@uparrow{$\Uparrow$}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand{\tin@right}[3][]{%
%	\node at (0,0) [anchor=south west] (tin) {\phantom{#2}\strut};
%	\begin{scope}[x=(tin.south east),y=(tin.north west)]
%		\fill[black] (0,0) {[rounded corners=1pt] -- ++(1,0) -- ++(0,1)} -- ++(-1,0) -- cycle {};
%	\end{scope}
%	\node at (0,0) [text=white] (btn) {#2\strut};
%}
%\newcommand{\TIRounded}[2][]{\tikz[baseline=(key.base)]{\node at (0,0) [inner sep=0pt, anchor=south west] (key) {\phantom{#2}\strut};
%		\begin{scope}[x=(key.south east),y=(key.north west)]
%			\fill[black] (0,0) {[rounded corners=1pt] -- ++(1,0) -- ++(0,1)} -- ++(-1,0) -- cycle {};
%\end{scope}}}
%%{\fill (0,0) -- ++(10pt,0) -- ++(0,\f@size pt) -- ++(-10pt,0) -- cycle {};}}
%\newcommand{\TIKeyDouble}[3][]{\tikz[baseline=(key.base)]{\node at (0,0) [key,minimum width=7ex,#1] (key) {#2\hspace{1ex}\strut#3};\draw[white] (key.north) -- (key.south);}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         General key macros             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\TIN}{{\sffamily TI-{$n$}\textbf{spire \textcolor{tinsecondaryclr}{\textit{CX}}}}\xspace}

\newcommand{\TINsmall}[2][]{\TINkey[inner sep=1pt,minimum size=2ex,#1]{\small #2}{}}
\newcommand{\TINbig}[2][]{\TINkey[minimum width={\tin@minwidth*1.5},#1]{#2}{}}

\newcommand{\TINwhite}[2]{\TINkey[black,fill=white,text=black]{#1}{#2}}

\newcommand{\TINcombo}[2]{#1+\ #2}
\newcommand{\TINfollow}[2]{#1$\rightarrow$\ #2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         Specific key macros            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\TINesc}{\@ifstar\@@TINesc\@TINesc}
\newcommand{\@TINesc}{\TINkey{esc}{$\Lsh$}}
\newcommand{\@@TINesc}{\TINkey{esc}{}}
\newcommand{\TINscratch}{\@ifstar\@@TINscratch\@TINscratch}
\newcommand{\@TINscratch}{\TINkey{\tin@calculator}{save}}
\newcommand{\@@TINscratch}{\TINkey{\tin@calculator}{}}
\newcommand{\TINtab}{\TINkey{tab}{}}

\newcommand{\TINon}{\@ifstar\@@TINon\@TINon}
\newcommand{\@TINon}{\TINkey{\tin@house\xspace on}{off}}
\newcommand{\@@TINon}{\TINkey{\tin@house\xspace on}{}}
\newcommand{\TINdoc}{\@ifstar\@@TINdoc\@TINdoc}
\newcommand{\@TINdoc}{\TINkey{doc \tin@caret}{+ page}}
\newcommand{\@@TINdoc}{\TINkey{doc \tin@caret}{}}
\newcommand{\TINmenu}{\@ifstar\@@TINmenu\@TINmenu}
\newcommand{\@TINmenu}{\TINkey{menu}{\tin@menu}}
\newcommand{\@@TINmenu}{\TINkey{menu}{}}


\newcommand{\TINctrl}{\TINkey[tinctrl]{ctrl}{}}
\newcommand{\TINshift}{\TINkey{\tin@uparrow\xspace shift}{CAPS}}
\newcommand{\TINvar}{\TINkey{var}{sto$\rightarrow$}}
\newcommand{\TINdel}{\TINkey{$\underleftarrow{\text{del}}$}{clear}}


\newcommand{\TINnum}[1]{\TINwhite{\textbf{#1}}{}}
\newcommand{\TINdot}{\TINwhite{.}{capture}}
\newcommand{\TINneg}{\TINwhite{(-)}{ans}}


\newcommand{\TINenter}{\@ifstar\@@TINenter\@TINenter}
\newcommand{\@TINenter}{\TINkey[minimum width=8ex]{enter}{$\approx$}}
\newcommand{\@@TINenter}{\TINkey[minimum width=8ex]{enter}{}}

\newcommand{\TINsqrt}{\TINleft[]{$\sqrt[n]{\hspace{1ex}}$}{}}

\newcommand{\TINx}{\TINsmall[black,fill=white,text=black]{X}}
\newcommand{\TINy}{\TINsmall[black,fill=white,text=black]{Y}}
\newcommand{\TINz}{\TINsmall[black,fill=white,text=black]{Z}}
\newcommand{\TINspace}{\TINsmall[minimum width=\tin@minwidth]{\textvisiblespace}}

\newcommand{\TINee}{\TINsmall{EE}}
\newcommand{\TINpi}{\TINsmall{$\pi$\tin@rcaret}}
\newcommand{\TINcomma}{\TINsmall{,}}

\newcommand{\TINsmbols}{\TINsmall{?!\tin@rcaret}}
\newcommand{\TINflag}{\TINsmall{F}}
\newcommand{\TINnewline}{\TINsmall{\rotatebox[origin=c]{180}{$\Rsh$}}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%        Combinations of keys            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\TINnumpad}{%
\begin{tabular}{ccc}
	\TINnum{1}{} & \TINnum{2}{} & \TINnum{3}{} \\
	\TINwhite{4}{} & \TINwhite{5}{} & \TINwhite{6}{} \\
	\TINwhite{7}{} & \TINwhite{8}{} & \TINwhite{9}{} \\
	\TINwhite{0}{} & \TINdot & \TINneg \\
\end{tabular}}
\newcommand{\TINkeyboard}{
	\begin{tabular}{ccccccc}
		\TINsmall{a} & \TINsmall{b} & \TINsmall{c} & \TINsmall{d} & \TINsmall{e} & \TINsmall{f} & \TINsmall{g} \\
		\TINsmall{h} & \TINsmall{i} & \TINsmall{j} & \TINsmall{k} & \TINsmall{l} & \TINsmall{m} & \TINsmall{n} \\
		\TINsmall{o} & \TINsmall{p} & \TINsmall{q} & \TINsmall{r} & \TINsmall{s} & \TINsmall{t} & \TINsmall{u} \\
		\TINsmall{v} & \TINsmall{w} & \TINx & \TINy & \TINz & \multicolumn{2}{c}{\TINspace}
	\end{tabular}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%          Display and menu              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newlength{\tin@menuWidth}
\def\tin@mWidth{}
\def\tin@mHeight{}
\newlength{\tin@wLine}

\newenvironment{tindisplay}{\begin{tikzpicture}
	\fill[gray!10,draw=black] (0,0) rectangle (8,6);
}{\end{tikzpicture}}

\newenvironment{tinwindow}[1]{\setlength{\tin@wLine}{-2em}\settowidth{\tin@menuWidth}{#1}\begin{tikzpicture}[x=1ex,y=1em,framed,background rectangle/.style={fill=tindisplayclr,draw=black},tight background]
	\pgfmathparse{\the\tin@menuWidth+2ex}\edef\tin@mWidth{\pgfmathresult}
	\node at (0,0) [anchor=north west,black,fill=black,rectangle,text=white,font=\sffamily,minimum width=\tin@mWidth,inner sep=1pt] {#1\strut};
}{\addtolength{\tin@wLine}{.5em}\node at (0,\the\tin@wLine) [anchor=north west] {};
\end{tikzpicture}}

\newcommand\TINwfield[2][]{%
	\node at (10,\the\tin@wLine) [anchor=north west,gray,thick,draw,fill=white,text=black,label={left:#2},minimum width=8ex,minimum height=1.5em] {#1};\addtolength{\tin@wLine}{-2em}
}
\def\TINwbtns#1#2{%
	\node at (10,\the\tin@wLine) [anchor=north west,gray,thick,draw,fill=white,text=black,minimum width=4ex,minimum size=1.5em] (ok) {#1};
	\node[anchor=north west,gray,thick,draw,fill=white,text=black,minimum width=4ex,right of=ok,xshift=.5em,minimum width=3ex,minimum height=1.5em] (cancel) {#2};
	\addtolength{\tin@wLine}{-2em}
}

\newcommand\texttin{\@ifstar\@@texttin\@texttin}
\newcommand{\@texttin}[1]{\textsf{\setlength{\fboxsep}{0pt}\colorbox{tindisplayclr}{\color{black}#1}}}
\newcommand{\@@texttin}[1]{\textsf{\setlength{\fboxsep}{0pt}\colorbox{tinselectionclr}{\color{white}#1}}}

\newenvironment{tinmenu}{\starttinmenu}{}
\def\starttinmenu#1\end{\begingroup\setlength\fboxsep{0pt}
	\colorbox{tindisplayclr}{\begin{tabular}{|lr|}\hline
		#1
\hline\end{tabular}}\endgroup\end}

% https://tex.stackexchange.com/questions/26360/how-to-color-the-font-of-a-single-row-in-a-table
\def\tin@rowclr{\color{black}}
\def\tin@endrow{\gdef\tin@rowclr{\color{black}}}
\def\TINselected{\rowcolor{tinselectionclr}\gdef\tin@rowclr{\color{white}}}

\def\TINmenuitem{\@ifstar\@@TINmenuitem\@TINmenuitem}
\def\@TINmenuitem#1{\tin@rowclr\textsf{#1} & \tin@endrow\tabularnewline}
\def\@@TINmenuitem#1{\tin@rowclr\textsf{#1} & \tin@rowclr\tin@rcaret\tin@endrow\tabularnewline}